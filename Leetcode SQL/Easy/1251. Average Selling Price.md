## Table: Prices

| Column Name | Type |
|-------------|------|
| product_id  | int  |
| start_date  | date |
| end_date    | date |
| price       | int  |

- (`product_id`, `start_date`, `end_date`) is the primary key (combination of columns with unique values).
- Each row indicates the price of a product during the period from `start_date` to `end_date`.
- For each `product_id`, there are no overlapping periods.

---

## Table: UnitsSold

| Column Name   | Type |
|---------------|------|
| product_id    | int  |
| purchase_date | date |
| units         | int  |

- This table may contain duplicate rows.
- Each row indicates the date, units sold, and product_id of a sale.

---

## Problem Statement

Write a solution to find the **average selling price** for each product.

- `average_price` should be rounded to **2 decimal places**.
- If a product does not have any sold units, its average selling price is assumed to be **0**.

Return the result table in **any order**.

The result format is shown in the following example.

---

## Example 1

### Input

**Prices table:**

| product_id | start_date | end_date   | price |
|------------|------------|------------|-------|
| 1          | 2019-02-17 | 2019-02-28 | 5     |
| 1          | 2019-03-01 | 2019-03-22 | 20    |
| 2          | 2019-02-01 | 2019-02-20 | 15    |
| 2          | 2019-02-21 | 2019-03-31 | 30    |

**UnitsSold table:**

| product_id | purchase_date | units |
|------------|---------------|-------|
| 1          | 2019-02-25    | 100   |
| 1          | 2019-03-01    | 15    |
| 2          | 2019-02-10    | 200   |
| 2          | 2019-03-22    | 30    |

---

### Output

| product_id | average_price |
|------------|---------------|
| 1          | 6.96          |
| 2          | 16.96         |

---

### Explanation

- Average selling price = **Total revenue / Total units sold**
- Product 1: `((100 × 5) + (15 × 20)) / 115 = 6.96`
- Product 2: `((200 × 15) + (30 × 30)) / 230 = 16.96`

---

## Answer

```sql
select p.product_id,
       round(
           ifnull(sum(u.units * p.price) / sum(u.units), 0),
           2
       ) as average_price
from Prices p
left join UnitsSold u
on p.product_id = u.product_id
and u.purchase_date between p.start_date and p.end_date
group by p.product_id;